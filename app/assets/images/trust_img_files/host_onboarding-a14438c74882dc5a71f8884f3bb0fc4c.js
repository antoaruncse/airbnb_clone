(function(){this.JST||(this.JST={});this.JST["host_onboarding/activeSelection"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;function program1(depth0,data){var buffer="",stack1;buffer+='    \n    <div class="panel-background-light-blue panel-border selected-item ';if(stack1=helpers.type){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.type;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'" data-type="';if(stack1=helpers.type){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.type;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'">\n      <div class="inner">\n        <i class="icon_lys ';if(stack1=helpers.iconClass){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.iconClass;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+' active"></i>\n        <h4 class="title-value">';if(stack1=helpers.title){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.title;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'</h4>\n      </div>\n      <div class="circle">                  \n        <div class="inner">\n          <i class="icon icon-arrow-up"></i>\n        </div>\n      </div>\n    </div>\n  ';return buffer}buffer+='<div class="active-selection" >\n  ';stack1=helpers["if"].call(depth0,depth0.isNotPersonCapacity,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data});if(stack1||stack1===0){buffer+=stack1}buffer+='\n  <div class="panel-background-well panel-background-well-blue panel-border ">\n    <strong>';if(stack1=helpers.message){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.message;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+"</strong>\n  </div>\n</div>\n";return buffer});return this.JST["host_onboarding/activeSelection"]}).call(this);(function(){this.JST||(this.JST={});this.JST["host_onboarding/errorModal"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,options,functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;buffer+='<div class="modal" id="error-modal" data-modal-sticky="true">\n  <div class="modal-body">\n    <p>';if(stack1=helpers.message){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.message;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'</p>\n  </div>\n  <div class="modal-footer">\n    <button class="btn close-modal">';options={hash:{},data:data};buffer+=escapeExpression(((stack1=helpers.t),stack1?stack1.call(depth0,"host_on_boarding.error_ok",options):helperMissing.call(depth0,"t","host_on_boarding.error_ok",options)))+"</button>\n  </div>\n</div>  \n";return buffer});return this.JST["host_onboarding/errorModal"]}).call(this);!(function($,Airbnb,global){var HostOnBoardingForm={},PROPERTY_TYPE_VIEW_INACTIVE_TEMPLATE=$(".fieldset_property_type_id").html(),ROOM_TYPE_VIEW_INACTIVE_TEMPLATE=$(".fieldset_room_type").html(),LOCATION_FIELD_VIEW_INACTIVE_TEMPLATE=$(".fieldset_city").html();HostOnBoardingForm.AppView=Backbone.View.extend({initialize:function(){var formModel=new HostOnBoardingForm.FormModel();new HostOnBoardingForm.FormView({model:formModel});new HostOnBoardingForm.LocationFieldView({model:formModel});new HostOnBoardingForm.PersonCapacityFieldView({model:formModel});new HostOnBoardingForm.SubmitButtonView({model:formModel});new HostOnBoardingForm.PropertyTypeView({model:formModel});new HostOnBoardingForm.RoomTypeView({model:formModel})}});HostOnBoardingForm.FormModel=Backbone.Model.extend({initialize:function(){this.on("change",this.isFormComplete);this.on("change:state",function(){var state=this.get("state");this.trigger("state:"+state)},this)},defaults:function(){return{state:"disabled",property_type_id:"",room_type:"",person_capacity:"2",city:"",submitButton:{disabled:{isDisabled:true,iconClass:"icon-ok",callToAction:function(){return I18n.t("host_on_boarding.cta.continue")}},active:{isDisabled:false,iconClass:"icon-ok",callToAction:function(){return I18n.t("host_on_boarding.cta.continue")}},loading:{isDisabled:true,iconClass:"icon-loading",callToAction:function(){return I18n.t("host_on_boarding.cta.loading")}}}}},isFormComplete:function(){var values=_.values(this.attributes);if(this.get("state")==="loading"){return}else{if(_.contains(values,"")||_.contains(values,undefined)){this.set({state:"disabled"})}else{this.set({state:"active"})}}},handleAjax:function(){var form=$(".host-onboarding-form"),url=form.attr("action"),data=form.serialize();$.ajax({url:url,data:data,dataType:"json",type:"post",success:_.bind(this.handleSuccess,this),error:_.bind(this.handleError,this)})},handleSuccess:function(data){if(data.status==="error"){return this.handleError(data)}if(data.status==="redirect"){if(Airbnb.Utils.isUserLoggedIn){global.location.href=data.to}else{Airbnb.SignupLoginModal.launchSignup({redirectUrl:data.to,callback:function(){$(document).off("modalClose");global.location.href=this.redirectUrl}})}}},handleError:function(data){var errorStatusText,errorModal=require("o2-modal"),errorModalEl=$("#error-modal");if(data.errors){errorStatusText=data.errors.base[0]}$("#js-submit-button").trigger("ajax:server_error",errorStatusText);if(errorModalEl.length===0){errorModal(global.JST["host_onboarding/errorModal"]({message:I18n.t("host_on_boarding.error_message")}))}errorModal.open(function(){$(".close-modal").on("click",function(){errorModal.close()})})}});HostOnBoardingForm.FormView=Backbone.View.extend({initialize:function(){this.model.on("state:loading",this.unbindEvents,this);this.model.on("state:active",this.rebindEvents,this);$(document).on("modalClose",$.proxy(this.handleModalClose,this))},unbindEvents:function(){this.undelegateEvents()},rebindEvents:function(){this.delegateEvents()},handleModalClose:function(){this.model.set("state","active")},renderActiveState:function(typeName,title,iconClass){var messages={room_type:I18n.t("host_on_boarding.message.room_type"),person_capacity:I18n.t("host_on_boarding.message.person_capacity"),property_type_id:I18n.t("host_on_boarding.message.property_type_id"),city:I18n.t("host_on_boarding.message.city")},data={title:title,type:typeName,iconClass:"icon_"+iconClass,message:messages[typeName],isNotPersonCapacity:typeName!=="person_capacity"},template=global.JST["host_onboarding/activeSelection"](data),$fieldsetEl=$(".fieldset_"+typeName),messageLength=messages[typeName].length;this.model.set(typeName,title);if(data.isNotPersonCapacity){$fieldsetEl.find(".unselected").hide()}else{$(".icon_accommodates").addClass("active");$fieldsetEl.find(".btn-dropdown").removeClass("open").addClass("active");$(".accommodates-num").html(title)}if($fieldsetEl.find(".active-selection").length===0){$(".tooltip").hide();$fieldsetEl.append(template)}if(messageLength<69){$fieldsetEl.find(".active-selection strong").addClass("oneline")}else{if(messageLength<135){$fieldsetEl.find(".active-selection strong").addClass("twoline")}}},setFieldValue:function(name,value){var roomTypes=["Entire home/apt","Private room","Shared room"];if(name==="room_type"){value=roomTypes[value]}$("#"+name).val(value);this.model.set(name,value)}});HostOnBoardingForm.SubmitButtonView=HostOnBoardingForm.FormView.extend({el:"#js-submit-button",events:{"click .clickable":"handleClick"},initialize:function(){this.render();this.model.on("change",this.render,this);this.model.on("state:loading",this.unbindEvents,this);this.model.on("state:active",this.rebindEvents,this)},render:function(){var template,newState=this.model.get("state"),submitButton=this.model.get("submitButton"),currentState=this.model.get("submitButtonState");if(currentState!==newState){template=global.JST["host_onboarding/submitButton"](submitButton[newState]);this.$el.html(template).trigger("_render",newState);this.model.set("submitButtonState",newState)}},handleClick:function(event){event.preventDefault();this.model.set("state","loading");this.model.handleAjax()}});HostOnBoardingForm.PersonCapacityFieldView=HostOnBoardingForm.FormView.extend({el:".fieldset_person_capacity",events:{"click .accommodates":"renderActive"},initialize:function(){this.model.on("location:focus",function(){this.model.off("location:focus");this.renderActive()},this);this.model.on("state:loading",this.unbindEvents,this);this.model.on("state:active",this.rebindEvents,this)},renderActive:function(e){var num;if(e){e.preventDefault();num=$(e.currentTarget).html()}else{num=this.model.get("person_capacity")}this.renderActiveState("person_capacity",num,"accommodates");this.setFieldValue("person_capacity",num)}});HostOnBoardingForm.LocationFieldView=HostOnBoardingForm.FormView.extend({el:".fieldset_city",events:{"geocode:result #location_input":"handleGeocode","change #location_input":"handleChange","focus #location_input":"handleFocus","keydown #location_input":"handleKeydown","click .selected-item":"renderInActive"},initialize:function(){Airbnb.Utils.withGooglePlaces(_.bind(this.initGeoComplete,this));this.model.on("state:loading",this.unbindEvents,this);this.model.on("state:active",this.rebindEvents,this)},initGeoComplete:function(){this.$el.find("#location_input").addClass("geocomplete").geocomplete({types:["(cities)"]})},handleGeocode:function(event,data){this.address=data.formatted_address;this.shortName=data.name||data.address_components[0].short_name;this.renderActive()},handleKeydown:function(e){if(e.keyCode===9||e.keyCode===13){e.preventDefault();Airbnb.Utils.withGooglePlaces(function(){$(e.currentTarget).geocomplete("find",$(".pac-container").last().find(".pac-item").first().text())})}},handleChange:function(){var self=this;window.setTimeout(function(){if(self.address){return false}var customLocation=self.$("#location_input").val();self.address=self.shortName=customLocation;self.renderActive()},500)},resetLocationData:function(){this.address=this.shortName=null},handleFocus:function(){this.resetLocationData();this.model.trigger("location:focus")},renderActive:function(){var label=this.$el.find("input").val();this.$el.html("");this.renderActiveState("city",this.shortName,"location");this.setFieldValue("city",this.address);this.$el.trigger("location:change",label)},renderInActive:function(){var currentLocationVal=this.model.attributes.city;this.$el.html(LOCATION_FIELD_VIEW_INACTIVE_TEMPLATE);this.$el.find("input").val(currentLocationVal).select();this.setFieldValue("city","");this.initGeoComplete()}});HostOnBoardingForm.PropertyTypeView=HostOnBoardingForm.FormView.extend({el:".fieldset_property_type_id",events:{"click .type":"renderActive","click .selected-item":"renderInactive"},renderActive:function(e){var currentEl=$(e.currentTarget),typeId=currentEl.data("type-id"),title=currentEl.data("name"),icon="property_type_id_"+typeId;e.preventDefault();if(typeId>3){icon="property_type_id_other"}this.$el.html("");this.renderActiveState("property_type_id",title,icon);this.setFieldValue("property_type_id",typeId)},renderInactive:function(){this.$el.html(PROPERTY_TYPE_VIEW_INACTIVE_TEMPLATE);this.setFieldValue("property_type_id","")}});HostOnBoardingForm.RoomTypeView=HostOnBoardingForm.FormView.extend({el:".fieldset_room_type",events:{"click .type":"renderActive","click .selected-item":"renderInactive"},renderActive:function(e){var currentEl=$(e.currentTarget),typeId=currentEl.data("type-id"),title=currentEl.find("span").html(),icon="room_type_"+typeId;this.$el.html("");this.renderActiveState("room_type",title,icon);this.setFieldValue("room_type",typeId)},renderInactive:function(){this.$el.html(ROOM_TYPE_VIEW_INACTIVE_TEMPLATE);this.setFieldValue("room_type","")}});provide("HostOnBoardingForm",HostOnBoardingForm)})(jQuery,Airbnb,window);(function(){this.JST||(this.JST={});this.JST["host_onboarding/submitButton"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,self=this,functionType="function",escapeExpression=this.escapeExpression;function program1(depth0,data){return" disabled "}function program3(depth0,data){return" clickable "}function program5(depth0,data){return' disabled="disabled" '}buffer+='<button type="submit" class="btn submit large pink ';stack1=helpers["if"].call(depth0,depth0.isDisabled,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data});if(stack1||stack1===0){buffer+=stack1}buffer+='" ';stack1=helpers["if"].call(depth0,depth0.isDisabled,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data});if(stack1||stack1===0){buffer+=stack1}buffer+=">\n  ";if(stack1=helpers.callToAction){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.callToAction;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+' \n  <i class="icon ';if(stack1=helpers.iconClass){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.iconClass;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'"></i>\n</button>\n';return buffer});return this.JST["host_onboarding/submitButton"]}).call(this);!function(global,Airbnb,$){var trackables,HostOnBoardingTracking,track;HostOnBoardingTracking={setSuperProperties:function(){var variation=JSCookie.cookie("hof");Airbnb.Tracking.Mixpanel.register({new_host_variation:variation})},track:function(options){this.eventName=options.eventName||"host_onboard_v1";this.setSuperProperties();for(var trackable in trackables){if(trackables.hasOwnProperty(trackable)){trackables[trackable].call(trackables)}}}};trackables={impressions:function(){var uiRef=Airbnb.Tracking.getUiRef(),lysLinkTracker=require("lys_link_tracker");track({action:"impressions",ui_referrer:uiRef,js_referrer:document.referrer,lys_link:lysLinkTracker.popUiReferrer()})},home_type:function(){var $field=$(".fieldset_property_type_id");$field.on("click","label",function(){track({action:"home_type_click",label:$(this).data("type-id")})});$field.on("click",".selected-item",function(){track({action:"home_type_expand"})});$field.on("click",".btn-dropdown",function(){track({action:"home_type_other_focus"})});$field.on("click",".dropdown-menu li",function(e){track({action:"home_type_other_change",label:$(this).find("a").data("type-id")});e.stopPropagation()})},room_type:function(){var $field=$(".fieldset_room_type");$field.on("click","label",function(){track({action:"room_type_click",label:$(this).attr("for")})});$field.on("click",".selected-item",function(){track({action:"room_type_expand"})})},accommodates:function(){var $field=$(".fieldset_person_capacity");$field.on("click",".dropdown-toggle",function(){track({action:"accomodates_focus"})});$field.on("click",".dropdown-menu",function(e){track({action:"accommodates_change",label:$field.find(".accommodates-num").text()});e.stopPropagation()})},location:function(){var $field=$(".fieldset_city");$field.on("focus","#location_input",function(){track({action:"location_focus"})});$field.on("location:change",function(e,label){track({action:"location_change",label:label})})},kontinue:function(){var $field=$("#js-submit-button");$field.on("_render",function(e,state){if(state==="active"){track({action:"continue_displayed"})}});$field.on("click",function(){track({action:"continue_clicked"})});$field.on("ajax:server_error",function(e,status){track({action:"continue_clicked_error",label:status})})}};track=function(_data){var defaultValues={category:HostOnBoardingTracking.eventName,forceTrack:true};var data=_.defaults(_data||{},defaultValues);Airbnb.Tracking.Mixpanel.track(HostOnBoardingTracking.eventName,data)};provide("HostOnBoardingTracking",HostOnBoardingTracking)}(this,Airbnb,jQuery);(function($,window,document,undefined){var defaults={bounds:true,country:null,map:false,details:false,detailsAttribute:"name",location:false,mapOptions:{zoom:14,scrollwheel:false,mapTypeId:"roadmap"},markerOptions:{draggable:false},maxZoom:16,types:["geocode"]};var componentTypes=("street_address route intersection political country administrative_area_level_1 administrative_area_level_2 administrative_area_level_3 colloquial_area locality sublocality neighborhood premise subpremise postal_code natural_feature airport park point_of_interest post_box street_number floor room lat lng viewport location formatted_address location_type bounds").split(" ");var placesDetails=("id url website vicinity reference name rating international_phone_number icon formatted_phone_number").split(" ");function GeoComplete(input,options){this.options=$.extend(true,{},defaults,options);this.input=input;this.$input=$(input);this._defaults=defaults;this._name="geocomplete";this.init()}$.extend(GeoComplete.prototype,{init:function(){this.initMap();this.initMarker();this.initGeocoder();this.initDetails();this.initLocation()},initMap:function(){if(!this.options.map){return}if(typeof this.options.map.setCenter=="function"){this.map=this.options.map;return}this.map=new google.maps.Map($(this.options.map)[0],this.options.mapOptions)},initMarker:function(){if(!this.map){return}var options=$.extend(this.options.markerOptions,{map:this.map});if(options.disabled){return}this.marker=new google.maps.Marker(options);google.maps.event.addListener(this.marker,"dragend",$.proxy(this.markerDragged,this))},initGeocoder:function(){var options={types:this.options.types,bounds:this.options.bounds===true?null:this.options.bounds,componentRestrictions:this.options.componentRestrictions};if(this.options.country){options.componentRestrictions={country:this.options.country}}this.autocomplete=new google.maps.places.Autocomplete(this.input,options);this.geocoder=new google.maps.Geocoder();if(this.map&&this.options.bounds===true){this.autocomplete.bindTo("bounds",this.map)}google.maps.event.addListener(this.autocomplete,"place_changed",$.proxy(this.placeChanged,this));this.$input.keypress(function(event){if(event.keyCode===13){return false}});this.$input.bind("geocode",$.proxy(function(){this.find()},this))},initDetails:function(){if(!this.options.details){return}var $details=$(this.options.details),attribute=this.options.detailsAttribute,details={};function setDetail(value){details[value]=$details.find("["+attribute+"="+value+"]")}$.each(componentTypes,function(index,key){setDetail(key);setDetail(key+"_short")});$.each(placesDetails,function(index,key){setDetail(key)});this.$details=$details;this.details=details},initLocation:function(){var location=this.options.location,latLng;if(!location){return}if(typeof location=="string"){this.find(location);return}if(location instanceof Array){latLng=new google.maps.LatLng(location[0],location[1])}if(location instanceof google.maps.LatLng){latLng=location}if(latLng){if(this.map){this.map.setCenter(latLng)}}},find:function(address){this.geocode({address:address||this.$input.val()})},geocode:function(request){if(this.options.bounds&&!request.bounds){if(this.options.bounds===true){request.bounds=this.map&&this.map.getBounds()}else{request.bounds=this.options.bounds}}if(this.options.country){request.region=this.options.country}this.geocoder.geocode(request,$.proxy(this.handleGeocode,this))},handleGeocode:function(results,status){if(status===google.maps.GeocoderStatus.OK){var result=results[0];this.$input.val(result.formatted_address);this.update(result);if(results.length>1){this.trigger("geocode:multiple",results)}}else{this.trigger("geocode:error",status)}},trigger:function(event,argument){this.$input.trigger(event,[argument])},center:function(geometry){if(geometry.viewport){this.map.fitBounds(geometry.viewport);if(this.map.getZoom()>this.options.maxZoom){this.map.setZoom(this.options.maxZoom)}}else{this.map.setZoom(this.options.maxZoom);this.map.setCenter(geometry.location)}if(this.marker){this.marker.setPosition(geometry.location);this.marker.setAnimation(this.options.markerOptions.animation)}},update:function(result){if(this.map){this.center(result.geometry)}if(this.$details){this.fillDetails(result)}this.trigger("geocode:result",result)},fillDetails:function(result){var data={},geometry=result.geometry,viewport=geometry.viewport,bounds=geometry.bounds;$.each(result.address_components,function(index,object){var name=object.types[0];data[name]=object.long_name;data[name+"_short"]=object.short_name});$.each(placesDetails,function(index,key){data[key]=result[key]});$.extend(data,{formatted_address:result.formatted_address,location_type:geometry.location_type||"PLACES",viewport:viewport,bounds:bounds,location:geometry.location,lat:geometry.location.lat(),lng:geometry.location.lng()});$.each(this.details,$.proxy(function(key,$detail){var value=data[key];this.setDetail($detail,value)},this));this.data=data},setDetail:function($element,value){if(value===undefined){value=""}else{if(typeof value.toUrlValue=="function"){value=value.toUrlValue()}}if($element.is(":input")){$element.val(value)}else{$element.text(value)}},markerDragged:function(event){this.trigger("geocode:dragged",event.latLng)},resetMarker:function(){this.marker.setPosition(this.data.location);this.setDetail(this.details.lat,this.data.location.lat());this.setDetail(this.details.lng,this.data.location.lng())},placeChanged:function(){var place=this.autocomplete.getPlace();if(!place.geometry){this.find(place.name)}else{this.update(place)}}});$.fn.geocomplete=function(options){var attribute="plugin_geocomplete";if(typeof options=="string"){var instance=$(this).data(attribute)||$(this).geocomplete().data(attribute),prop=instance[options];if(typeof prop=="function"){prop.apply(instance,Array.prototype.slice.call(arguments,1));return $(this)}else{if(arguments.length==2){prop=arguments[1]}return prop}}else{return this.each(function(){var instance=$.data(this,attribute);if(!instance){instance=new GeoComplete(this,options);$.data(this,attribute,instance)}})}}})(jQuery,window,document);